@page "/"
@inject GoogleClient Client

<PageTitle>Home</PageTitle>

<table>
    <tbody>

@foreach (var item in Points)
{
        <tr>
            <td>@item.Description</td>
            <td>@item.LatLong.Lat</td>
            <td>@item.LatLong.Long</td>
            <td>
                <button @onclick="() => ShowMap(item)">Show Map</button>
            </td>
        </tr>
}
    </tbody>
</table>

@if(Point is not null)
{
    <GoogleMap Description="@Point.Description" Lat="@Point.LatLong.Lat" Long="@Point.LatLong.Long"
                                     ApiKey="@GoogleKey"
                                     @key="Point" />
}

@code{
    IEnumerable<GooglePoint> Points = [];
    GooglePoint Point = null;
    string GoogleKey = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        Points = await Client.GetPoints();
        GoogleKey = await Client.GetKey();
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            ShowMap(new GooglePoint
            {
                LatLong = new LatLong
                {
                    Lat = 15.17,
                    Long = 120.59
                },
                Description = "Sergi's house"
            });
        }
    }

    void ShowMap(GooglePoint point)
    {
        Point = point;
    }
}
